Кeyboard Layer/2
----------------

Краткое описание

    Keyboard Layer/2 представляет собой альтернативный переключатель
    латинского и национального регистра клавиатуры для OS/2 версии 4.0,
    4.5 и eComStation. Кроме того драйвер отображает состояние регистра 
    с помощью специального индикатора и позволяет переключать раскладки 
    клавиатуры с помощью назначенных горячих клавиш.

    Обратите внимание: Keyboard Layer/2 не является руссификатором OS/2!
    Он является альтернативным переключателем между национальным и 
    латинским регистром клавиатуры и, соответственно, преспокойно может
    использоваться в странах, имеющих, как и Россия, собственный и латинский
    регистры.

    Кроме того, если Вас все устраивает в стандартном способе переключе-
    ния, Keyboard Layer/2 может использоваться просто как индикатор. Для
    этого установите в настройках "Не трогай мою клавиатуру!" :)
    
    Соответственно руководству IBM "IBM OS/2 Warp 4 Клавиатуры и кодовые
    раскладки" переключение между национальным и латинским регистром 
    клавиатуры должно работать в следующих странах:

    Страна и раскладки:        
    -------------------------------------------------------------
    Арабские страны (ar и ar470)
    Болгария (bg и bg241)
    Греция (gk и el459)
    Израиль (il)
    Латвия (lv)
    Македония (mk)
  * Россия (ru441 и ru443)
    Сербия и черногория (sr)
    Таиланд (th и th190)
    -------------------------------------------------------------    

    * это единственная протестированная страна

Замечание
---------

    Если на Вашей машине установлен HPFS386 с Local Security, то Вам нужно
    убедиться в том, что каталог, в который установлен Keyboard Layer/2, 
    всегда доступен для чтения.

OS/2 Warp 3.0
-------------

    Я тестировал Keyboard Layer с версией Warp 3.0 Connect. После установки
    фикспака 40, необходимо выбрать страну Russian и раскладку RU441 или
    RU443 в Selective Install. Имелась только одна проблема: для корректного
    переключения в PM необходимы динамические библиотеки CYRIME.DLL, PMBIDI.DLL и
    BDCALL32.DLL которых нет в 3-й версии OS/2. Данные библиотеки включены в 
    поставку KL/2 и устанавливаются автоматически при инсталляции переключателя. 
    Я не знаю, какой минимальный уровень сервиса необходим OS/2 Warp 3.0, так 
    как у меня нет желания скачивать другие фикспаки и проводить с ними 
    эксперименты
    
Известные проблемы
------------------

  - Если   окно   какой-либо   программы,   пользующейся  аналогичным  с
    Keyboard Layer/2 алгоритмом всплытия пересечется  с  окном индикатора
    клавиатуры, то скорее  всего они учинят битву за первенство со 100% 
    загрузкой процессора. В этом случае просто растащите их подальше друг 
    от друга.

  - При переключении по ALT and SHIFTs, возможно переключения только при
    нажатии на левый ALT и SHIFT, и правый ALT и  SHIFT.  Варианты, ког-
    да ALT и SHIFT находятся по разную сторону клавиатуры не работают.

  - В  полноэкранных  сессиях  OS/2 блокируется стандартное переключение
    регистров.

  - При включенном режиме "Transparent focus" Keyboard Layer/2 не вызыва-
    ется из списка задач.

  - Режим "Transparent focus" не работает  при  включенных  режимах "Move
    Pointer to Focus", "Activate Window a Pointer"  и  выключенном  "Only
    when Pointer is Moved" в NPS WPS Enhancer.

  - Выбор регистра по умолчанию не влияет на открываемые полноэкранные
    сессии OS/2

  - При использовании Process Commander 1.0 имеются проблемы при 
    переключении в VDM. Это проблемы Process Commander, Keyboard Layer/2
    здесь не причем.

История изменений
-----------------

    Version 3.0.2

    fix: Исправлена инсталляция переключателя под OS/2 3.0.
    upd: Keyboard Layer/2 не выполняет никаких операций если размер
         стека активной программы меньше 1024 байт.

    Version 3.0.1

    upd: Добавлена возможность отображения иконок для текущей раскладки и 
         регистра.
    upd: Keyboard Layer/2 распространяется под лицензией GPL.
    upd: VDD Драйвер копируется в загрузочный каталог OS/2 для того чтобы
         избежать проблем с его загрузкой при установке программы в каталог,
         содержащий пробелы в своем имени.
    add: Добавлена возможность смены раскладки клавиатуры "на лету" с помощью
         назначенных горячих клавиш.
    upd: Поддержка SysTray/WPS может быть включена или выключена в диалоге
         настройки.
    upd: Улучшено отображение меню раскладок при большом их количестве.
    upd: Можно менять размер окна настройки.
    fix: При выборе национального регистра по умолчанию, не окрашивалась рамка 
         экрана при старте VDM.

    Version 2.1.3

    upd: Переключатель должен нормально работать с приложениями ODIN и InnoTek.

    Version 2.1.2

    fix: Исправлена ошибка открытия каталога сообщений при запуске
         программы из другого каталога.

    Version 2.1.1

    fix: Исправлены утилиты инсталляции и деинсталляции.

    Version 2.1.0
    
    add: Поддержка SysTray/WPS.
    upd: Переписаны утилиты инсталляции и деинсталляции.

    Version 2.0.2

    upd: Регистр клавиатуры для нового окна устанавливается в соответствии с
         текущим регистром его родителя или владельца. (В случае
         если не включена принудительная установка латинского или
         национального регистра)

    Version 2.0.1

    add: Переключение по клавишам CTRL+SHIFT.
    add: Улучшены иконки 40x40 и добавлен объект для запуска LAYOUT.EXE.
    upd: Некоторые мелкие исправления и добавления по поводу скрытия
         индикатора.
    
    Version 2.0.0

    add: Переключение по клавишам Windows.
    fix: Проведена работа по преодолению ошибки в Process Commander 1.0,
         приводившей к игнорированию серой "*" в полноэкранных сессиях 
         OS/2.
    upd: Более продвинутый механизм переключения.
    add: В состав пакета включена утилита LAYOUT.EXE - более продвинутый
         аналог осевого KEYB.
    upd: Цвета индикатора теперь хранятся для каждой раскладки отдельно.
    add: Добавлено всплывающее по нажатию горячих клавиш окно, позволяющее
         сменить раскладку клавиатуры.
    fix: Потеря индикатором фокуса после закрытия диалога настройки,
         даже если он находился в фокусе перед вызовом диалога.
    fix: Отсутствие переключения по левому CONTROL в полноэкранных
         сессиях OS/2
    upd: В дистрибутив пакета включены также библиотеки PMBIDI.DLL и 
         BDCALL32.DLL для поддержки OS/2 Warp версии 3.0
    add: Возможность выбора регистра по умолчанию для новых окон.
    add: Смена текущей раскладки из контекстного меню.
    fix: Определение загрузочного диска в скрипте инсталляции

    Version 1.1.0

    upd: Цвета, шрифт и позиция для индикатора сохраняются сразу же  после
         их изменения, а не при завершении работы, как было ранее.
    add: Русскоязычные меню, диалоги и программа инсталляции.
    add: Таймаут для клавиш переключения. Если последовательность 
         переключения не будет полностью опознана в течении указанного 
         времени, переключение не производится.
    add: Добавлен переключатель "Плавать выше всех" в контекстное меню.
    upd: Лайер отслеживает не только активацию окон но и изменение фокуса
         для дочерних окон. Так как в некоторых случаях, при вызове меню,
         основное окно переключается в латинский регистр. Причина мне
         неизвестна.
    add: Добавлен ряд альтернативных комбинаций клавиш для переключения
         регистров.

    Version 1.0.1

    fix: самопроизвольное переключение регистра в  полноэкранных  сессиях
         OS/2 при выборе переключения по LEFT SHIFT and RIGHT SHIFT.
    upd: алгоритм всплытия индикатора. Индикатор лезет вверх только в том
         случае, если пересекающееся с ним окно  действительно  находится
         над ним.

    Version 1.0.0

    add: режим "Transparent focus". При включении этого режима, индикатор
         не захватывает фокус ввода при закрытии или скрытии окна.

    Version 0.6 prerelease

    add: вызов  контекстного  меню  с  помощью  клавиатуры   (обычно это
         SHIFT-F10).  Для  облегечения  доступа с клавиатуры фокус ввода
         для индикатора отображается специальной рамочкой.
    add: изменение цвета фона индикатора для  национального регистра ме-
         няет цвет рамки в VDM, управление этой возможностью осуществля-
         ется переключателем "VDM color synchronize" в диалоге настройки.
    fix: индиктор выскакивал вверх при блокировке (lockup) экрана.
    fix: ошибка  в  типе  сегмента VDD, в итоге, сегмент данных, который
         должен был быть уникальным для  каждой  VDM, оказался разделяе-
         мым.

    Version 0.5 prerelease

    fix: переключение по ALT and SHIFTs в PM.
    add: запрет запуска второй копии программы.
    fix: изменения  в  алгоритме  управления цветом рамки в сессиях DOS.
         Предыдущий алгоритм вызывал конфликты с резидентными программа-
         ми, также управляющими цветом рамки.

    Version 0.4 prerelease

    add: вывод имени текущего регистра в пайп с именем \PIPE\KBDLAY2.
    add: drag'n'drop цветов и шрифтов.

    Version 0.3 prerelease

    add: в контекстное меню добавлены  пункты,  скрывающие индикатор ре-
         гистра,  и  пункт,  управляющий наличием переключателя в списке
         задач.

    add: добавлен virtual device driver,  поддерживающий  переключение в
         оконных и полноэкранных DOS сессиях.

    Version 0.2 prerelease

    fix: ошибка  с обработкой функциональных клавиш в полноэкранных сес-
         сиях OS/2.

Специальные спасибы
-------------------

    - Oleg Kostyuchenko aka Chill и Vadim Vozniouk aka Pirks за помощь 
      в подготовке английской версии данной документации.
    - Yaroslav Komarov за исходные тексты для поддержки SysTray/WPS.

Техническая поддержка
---------------------

    Версия 3.0.1 является последней версией Keyboard Layer/2 и более
    не поддерживается автором. Отсутствие поддержки означает, что
    обновление Keyboard Layer/2 будет производится только в том
    случае, если автору захочется чего-нибудь исправить или добавить
    для собственных нужд. Для всех остальных случаев - имеются
    исходные тексты. Можно также пожертвовать денег на развитие
    программы.
 
    Если есть вопросы по исходным текстам, можете отправить их с помощью 
    E-mail по адресу:

                glass@ptv.ru

    Также можете заглянуть на страницы в интернет:

                http://glass.os2.spb.ru/
                http://glass.ptv.ru/

    Дмитрий А.Стекленев

